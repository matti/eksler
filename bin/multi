#!/usr/bin/env bash
set -euo pipefail
. functions.sh

direction=$1
prefix=$2
amount=$3

export POOLS="x-1-pre all-1-pre"
for ((i=0; i<amount; i++)); do
  name="$prefix-${i}"
  (
    case $direction in
      up)
        _forever bin/main eu-north-1 $name ipv6 1
      ;;
      down)
        bin/eksler delete eu-north-1 $name
      ;;
    esac

    _done
  ) 2>&1 | sed -le "s#^# ++ $direction $name: #;" &
done


wait $(jobs -p)
